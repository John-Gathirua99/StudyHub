{% extends 'content/base.html' %}

{% block content %}
<div class="max-w-5xl mx-auto px-4 py-8">
  <h2 class="text-3xl font-bold text-gray-800 mb-6 border-b pb-2">Submitted Exams</h2>

  {% if submission_data %}
    <ul class="space-y-6">
      {% for item in submission_data %}
        <li class="bg-white rounded-lg shadow hover:shadow-md transition-shadow p-6">

          <!-- Header Row -->
          <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center mb-4">
            <div>
              <p class="text-xl font-semibold text-blue-700">
                {{ item.submission.student.user.username }}
              </p>
              <p class="text-sm text-gray-600">
                {{ item.submission.exam.title }} &middot;
                <span class="italic">{{ item.submission.submitted_at|date:"M d, Y H:i" }}</span>
              </p>
            </div>

            <div class="text-sm text-right mt-3 sm:mt-0">
              {% if item.submission.graded %}
                <span class="inline-flex items-center px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs font-medium">
                  ✔️ Graded
                </span>
              {% else %}
                <a href="{% url 'grade_exam' item.submission.id %}"
                   class="inline-block px-4 py-2 text-sm font-medium text-white bg-green-600 hover:bg-green-700 rounded-md">
                  Grade
                </a>
              {% endif %}
              <p class="mt-2 text-gray-700">
                <span class="font-medium">Score:</span>
                <span class="text-blue-800 font-semibold">{{ item.total_awarded }}</span> /
                <span class="text-gray-500">{{ item.total_possible }}</span>
              </p>
            </div>
          </div>

          <!-- Answer Breakdown -->
          <div class="mt-2 border-t pt-4">
            <ul class="space-y-3 text-sm text-gray-700">
              {% for ans in item.answers %}
                <li class="bg-gray-50 p-3 rounded-md border">
                  <p class="mb-1"><strong>Q:</strong> {{ ans.question.text|truncatechars:100 }}</p>
                  <p>
                    <strong>Marks:</strong>
                    <span class="text-blue-800 font-semibold">{{ ans.awarded_marks }}</span> /
                    <span class="text-gray-600">{{ ans.question.total_marks }}</span>
                  </p>
                </li>
              {% endfor %}
            </ul>
          </div>

        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p class="text-gray-500 text-center mt-10">No submitted exams available at the moment.</p>
  {% endif %}
</div>
{% endblock %}
